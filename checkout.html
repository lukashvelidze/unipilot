<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>UniPilot Checkout</title>
    <script src="https://cdn.paddle.com/paddle.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 2em;
        text-align: center;
        background-color: #f4f4f4;
      }
      button {
        font-size: 18px;
        padding: 1em 2em;
        background: #0070f3;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h2>Start Your UniPilot Premium Subscription</h2>
    <button id="pay">Subscribe with Paddle</button>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const email = urlParams.get("email") || "test@example.com";
      const clientToken = "test_c25cc3df5ddfcd6b3b2a8420700"; // your test token
      const priceId = "pri_01jyk3h7eec66x5m7h31p66r8w";

      const tryInitialize = () => {
        if (typeof Paddle === "undefined") {
          console.log("Paddle not loaded yet...");
          setTimeout(tryInitialize, 100);
          return;
        }

        console.log("Paddle loaded, initializing...");
        Paddle.Environment.set("sandbox");
        Paddle.Initialize({ token: clientToken });

        const btn = document.getElementById("pay");
        btn.addEventListener("click", () => {
          console.log("Opening Paddle checkout...");
          try {
            Paddle.Checkout.open({
              items: [{ priceId }],
              customer: { email },
              settings: {
                displayMode: "overlay",
                successUrl: "https://lukashvelidze.github.io/unipilot/success.html",
              },
            });
          } catch (e) {
            console.error("Failed to open checkout", e);
            alert("Something went wrong. Please try again later.");
          }
        });
      };

      tryInitialize();
    </script>
  </body>
</html>
